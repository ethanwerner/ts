// TODO: ts_parameters_t

/*

DESCRIPTION

INDICATORS

http://help.cqg.com/cqgic/19/default.htm#!Documents/studies1.htm
https://library.tradingtechnologies.com/trade/chrt-technical-indicators.html
https://www.tradingtechnologies.com/xtrader-help/x-study/technical-indicator-definitions/list-of-technical-indicators/
https://tulipindicators.org/list

[ ] ADX/DMS - Directional Movement Average
[ ] ATR Bands
[ ] ATR Trailing Stops
[ ] Absolute Price Oscillator (APO)
[ ] Acceleration Bands (ABANDS)
[ ] Accumulation/Distribution (AD)
[ ] Accumulation/Distribution Line
[ ] Accumulation/Distribution Oscillator
[ ] Accumulative Swing Index (ASI)
[ ] Adaptive Moving Average (AMA)
[ ] Alligator
[ ] Annualized Historical Volatility
[ ] Aroon (AR)
[ ] Aroon Oscillator (ARO)
[ ] Average Directional Movement (ADX)
[ ] Average Directional Movement Rating
[ ] Average Price
[ ] Average True Range (ATR)
[ ] Awesome Oscillator
[ ] Balance of Power
[ ] Band Width (BW)
[ ] Bar External Data (BarXData)
[ ] Bar Value Area (BVA)
[ ] Bid Volume (BVOL)
[ ] Boll %B
[ ] Bollinger Band (BBANDS)
[ ] Bollinger Band Difference (BDIF)
[ ] CVB External Data (CVBXData)
[ ] Candlestick Formations (CndlFm)
[ ] Center of Gravity (COG)
[ ] Chaikin Money Flow (CMF)
[ ] Chaikin Volatility (CV)
[ ] Chande Forecast Oscillator (CFO)
[ ] Chande Momentum Oscillator (CMO)
[ ] Channel (CHNL)
[ ] Chart Analog Overlay (Analog)
[ ] Choppiness Index
[ ] Commodity Channel Index (CCI)
[ ] Congestion Count (ConCnt)
[ ] Coppock Curve (CC)
[ ] Correlation Coefficient
[ ] Darvas Box
[ ] Degree-Radian
[ ] Delta Contours (Delta)
[ ] Detrended Price Oscillator (DPO)
[ ] Directional Indicator
[ ] Directional Movement
[ ] Directional Movement Index (DMI)
[ ] Directional Movement Index Difference (DDif)
[ ] Directional Movement Indicators (DMI)
[ ] Disparity Index
[ ] Divergence Index (Diver)
[ ] Donchian Channel
[ ] Donchian Width
[ ] Ease of Movement (EOM)
[ ] Ehler Fisher Transformation (EFT)
[ ] Elder Force Index (EFI)
[ ] Elder Impulse System
[ ] Elder Ray Index (ER)
[ ] Envelope (Env)
[ ] External Data (XData)
[ ] Fancy On Balance Volume (FOBV)
[ ] Fast Stochastics (FStoch)
[ ] Fill Indicator (FILL)
[ ] Fisher Transform
[ ] Forecast Oscillator
[ ] Fractal Chaos Bands (FCB)
[ ] Fractal Chaos Oscillator (FCO)
[ ] Gator Oscillator
[ ] Gopalakrishnan Range Index (GAPO)
[ ] High Low Bands (HLB)
[ ] High Minus Low (H-L)
[ ] Highest High Value (HH)
[ ] Historical Volatility (HV)
[ ] Hull Moving Average
[ ] Ichimoku (ICH)
[ ] Ichimoku Clouds (ICH)
[ ] Ichimokukinkouhyou (Imoku)
[ ] Implied Volatility (ImpVol)
[ ] Intraday Momentum Index (IMI)
[ ] Kalman Filter
[ ] Kaufman Adaptive Moving Average
[ ] Keltner Channel (KC)
[ ] Klinger Volume Oscillator (KVO)
[ ] Linear Regression (LR)
[ ] Linear Regression Angle (LRA)
[ ] Linear Regression Forecast (LRF)
[ ] Linear Regression Intercept (LRI)
[ ] Linear Regression R2 (R2)
[ ] Linear Regression Slope (LRS)
[ ] Lowest Low Value (LL)
[ ] Mark Fisher Indicator (MBF)
[ ] Market Facilitation Index
[ ] Market Profile Value Areas (MPVA)
[ ] Mass Index (MI)
[ ] Median Price (MP)
[ ] Mesa Sine Wave
[ ] Midpoint (MIDPNT)
[ ] Midprice (MIDPRI)
[ ] MinMax (MINMAX)
[ ] Missing Bar Count (MBCnt)
[ ] Momentum (MOM)
[ ] Money Flow Index (MFI)
[ ] Moving Average Convergence/Divergence (MACD)
[ ] Moving Average Cross (MAx)
[ ] Moving Average Envelope (MAE)
[ ] Moving Linear Regression (MLR)
[ ] Moving Linear Regression R Squared (MLRR2)
[ ] Negative Volume Index
[ ] Normalized Average True Range (NATR)
[ ] On Balance Volume (OBV)
[ ] Open Interest (OI)
[ ] Oscillator (Osc)
[ ] Oscillator - MA of Oscillator (OsMA)
[ ] Oscillator 1 - Oscillator 2 (OsD)
[ ] Oscillator Cross (OSCx)
[ ] PLOT (PLT)
[ ] Parabolic (Para)
[ ] Parabolic Sar (SAR)
[ ] Percent Price Oscillator (PPO)
[ ] Percent R (%R)
[ ] Percentage Price Oscillator
[ ] Performance Index
[ ] Pivot Points
[ ] Plus DI (DI+)
[ ] Positive Volume Index
[ ] Pretty Good Oscillator
[ ] Price Channel (PC)
[ ] Price Momentum Oscillator
[ ] Price Rate of Change (PROC)
[ ] Price Volume Trend (PVT)
[ ] Prime Number Bands
[ ] Prime Number Oscillator
[ ] Pring's Know Sure Thing
[ ] Pring's Special K
[ ] Psychological Line
[ ] Qstick
[ ] RAVI
[ ] RSI
[ ] Radian-Degree
[ ] Rainbow Moving Average
[ ] Rainbow Oscillator
[ ] Random Walk Index
[ ] Rank (Rank)
[ ] Rate of Change (ROC)
[ ] Rate of Change (ROC100)
[ ] Rate of Change (ROCP)
[ ] Rate of Change (ROCR)
[ ] Relative Strength Index (RSI)
[ ] Relative Strength Indicator (RSI)
[ ] Relative Vigor Index
[ ] Relative Volatility
[ ] Reversal (Rev)
[ ] STARC Bands
[ ] Schaff Trend Cycle
[ ] Session Cumulative Bid (SBVOL)
[ ] Session Volume (S_VOL)
[ ] Shinohara Intensity Ratio
[ ] Slow Stochastics (SStoch)
[ ] Standard Error
[ ] Stochastic (STOCH)
[ ] Stochastic Fast (StochF)
[ ] Stochastic Momentum Index (STOCH)
[ ] Stochastic Oscillator (STOCH)
[ ] Stochastic RSI
[ ] Supertrend
[ ] Swing Index
[ ] Synthetic Yield (SYield)
[ ] T3 (T3)
[ ] TFlow External Data (TFXData)
[ ] TFlow On Balance Volume (TFOBV)
[ ] TT Cumulative Vol Delta (TT CVD)
[ ] TT Cumulative Volume Delta (TT_CVD)
[ ] Tick Volume (TckVol)
[ ] Time Series Forecast (TSF)
[ ] Trade Volume Index (TVI)
[ ] Trend Intensity Index
[ ] Triangular Moving Average
[ ] True Range
[ ] Twiggs Money Flow
[ ] Typical Price
[ ] Ulcer Index
[ ] Ultimate Oscillator (ULTOSC)
[ ] VWAP
[ ] Valuation Lines
[ ] Variable Index Dynamic Average
[ ] Vertical Horizontal Filter
[ ] Volatility (Volty)
[ ] Volatility Stop (VolStp)
[ ] Volatility System (VolSys)
[ ] Volume (VOLUME)
[ ] Volume At Price (VAP)
[ ] Volume At Price (VAP)
[ ] Volume Delta (Vol âˆ†)
[ ] Volume Oscillator
[ ] Volume Profile (VP)
[ ] Volume Rate of Change
[ ] Volume Underlay
[ ] Volume Weighted Average Price (VWAP)
[ ] Volume Weighted Moving Average
[ ] Volume and Open Interest (VolOI)
[ ] Volume on the Ask (AVol)
[ ] Volume on the Bid (BVol)
[ ] Volume on the Bid and Ask (BAVOL)
[ ] Volume-Weighted Average Price (VWAP)
[ ] Vortex Indicator
[ ] Weighted Close Price
[ ] Welles Wilder's Smoothing Average (WWS)
[ ] Wilders Smoothing
[ ] Williams % R (WillR)
[ ] Williams % R (WillR)
[ ] Williams %R
[ ] Williams Accumulation/Distribution
[ ] Zero-Lag Exponential Moving Average
[ ] ZigZag (ZZ)
[X] Absolute Value
[X] Addition
[X] Arccosecant
[X] Arccosine
[X] Arccotangent
[X] Arcsecant
[X] Arcsine
[X] Arctangent
[X] Base-10 Log
[X] Base-2 Log
[X] Base-n Log
[X] Ceiling
[X] Cosecant
[X] Cosine
[X] Cotangent
[X] Crossover
[X] Cube Root
[X] Cumulative Moving Average
[X] Delta
[X] Division
[X] Double Exponential Moving Average (DEMA)
[X] Decay Exponential
[X] Moving Average Exponential
[X] Standard Deviation Exponential
[X] Variance Exponential
[X] Exponential
[X] Exponential Base-n
[X] Floor
[X] Hyperbolic Arccosecant
[X] Hyperbolic Arccosine
[X] Hyperbolic Arccotangent
[X] Hyperbolic Arcsecant
[X] Hyperbolic Arcsine
[X] Hyperbolic Arctangent
[X] Hyperbolic Cosine
[X] Hyperbolic Cossecant
[X] Hyperbolic Cotangent
[X] Hyperbolic Secant
[X] Hyperbolic Sine
[X] Hyperbolic Tangent
[X] Lag
[X] Linear Decay
[X] Linear Regression Simple Least Squares
[X] Maximum
[X] Mean Deviation
[X] Minimum
[X] Multiplication
[X] N-Root
[X] Natural Log
[X] Polynomial
[X] Power
[X] Ratio
[X] Reciprocal
[X] Round
[X] Secant
[X] Sigmoid
[X] Sign
[X] Simple Moving Average
[X] Sine
[X] Slope
[X] Square Root
[X] Standard Deviation
[X] Subtraction
[X] Summation
[X] Tangent
[X] Triangular Moving Average (TRIMA)
[X] Triple Exponential Moving Average (TEMA)
[X] Trix
[X] Truncate
[X] Variance
[X] Weighted Moving Average (WMA)

*/

#ifndef TIME_SERIES_H
#define TIME_SERIES_H


#include <stdint.h>
#include <stdbool.h>


typedef double    fp_t;
typedef uint64_t  uint_t;
typedef int64_t   int_t;


#define PI 3.14159265358979323846264338327950288419716939937510
#define HALF_PI 1.57079632679489661923132169163975144209858469968755


#define ts_o( x, i ) ( x[0][i] )
#define ts_h( x, i ) ( x[1][i] )
#define ts_l( x, i ) ( x[2][i] )
#define ts_c( x, i ) ( x[3][i] )
#define ts_v( x, i ) ( x[4][i] )


#define TS_TEST_K 5


typedef void ts_constant_t;


typedef struct {
	uint_t x;
	uint_t y;
	int_t c;
} ts_parameter_t;


#define ts_parameter( FUNCTION, X_N, Y_N, C_N ) \
	ts_parameter_t const ts_## FUNCTION ##_p = { .x = X_N, .y = Y_N, .c = C_N }


#define ts_function_declare( FUNCTION )	                       \
	extern ts_parameter_t const ts_## FUNCTION ##_p;           \
   	uint_t ts_## FUNCTION ##_offset( ts_constant_t const * );  \
    void ts_## FUNCTION(                                       \
		fp_t * const y[ts_## FUNCTION ##_p.y],                 \
		fp_t const * const x[ts_## FUNCTION ##_p.x],           \
		uint_t,                                                \
		ts_constant_t const *                                  \
	);                                                         \
	bool ts_## FUNCTION ##_test( void )
 

#define ts_function_define( FUNCTION, OFFSET )                 \
	uint_t ts_## FUNCTION ##_offset( ts_constant_t const *c )  \
	{                                                          \
		return ( OFFSET );                                     \
	}                                                          \
                                                               \
	void ts_## FUNCTION(                                       \
		fp_t * const y[ts_## FUNCTION ##_p.y],                 \
		fp_t const * const x[ts_## FUNCTION ##_p.x],           \
		uint_t n,                                              \
		ts_constant_t const *c                                 \
	)                                                          \


#define TS_TEST_EPSILON 1.0e-5


bool ts_test(
	void ( *function )( 
		fp_t * const *y, 
		fp_t const * const *x, 
		uint_t n, 
		ts_constant_t const *c 
	),
    uint_t ( *ts_offset )( 
		ts_constant_t const *c 
	),
	fp_t const * const *x,
	fp_t const * const *e,
	uint_t n,
	ts_constant_t const *c,
	ts_parameter_t const *m );

void ts_test_all( void );


#define ts_cast_byte( data, byte, type )           \
(                                                  \
	*( type * ) ( ( ( uint8_t * ) data ) + byte )  \
)


fp_t * ts_fill( fp_t *x, uint_t n, fp_t x0, fp_t x1 );
void ts_print( fp_t *x, uint_t n );
void ts_pretty_print( fp_t const * const *x, uint_t m, uint_t n );


fp_t _ts_square( fp_t );
fp_t _ts_reciporical( fp_t );
fp_t _ts_square_pyramidal_number( fp_t );
fp_t _ts_triangle_number( fp_t );
fp_t _ts_sum_to_covariance( fp_t, fp_t, fp_t, uint_t );
fp_t _ts_sum_to_variance( fp_t, fp_t, uint_t );
void _ts_assert_approximate( fp_t, fp_t, fp_t );


ts_constant_t* ts_constant( void );
uint_t _ts_circle_increment( uint_t, uint_t );


ts_function_declare( absolute_value );
ts_function_declare( addition );
ts_function_declare( average );
ts_function_declare( average_cumulative );
ts_function_declare( average_exponential );
ts_function_declare( average_exponential_double );
ts_function_declare( average_exponential_triple );
ts_function_declare( average_triangle );
ts_function_declare( average_weighted );
ts_function_declare( average_weighted_volume );
ts_function_declare( ceiling );
ts_function_declare( cosecant );
ts_function_declare( cosecant_hyperbolic );
ts_function_declare( cosecant_hyperbolic_inverse );
ts_function_declare( cosecant_inverse );
ts_function_declare( cosine );
ts_function_declare( cosine_hyperbolic );
ts_function_declare( cosine_hyperbolic_inverse );
ts_function_declare( cosine_inverse );
ts_function_declare( cotangent );
ts_function_declare( cotangent_hyperbolic );
ts_function_declare( cotangent_hyperbolic_inverse );
ts_function_declare( cotangent_inverse );
ts_function_declare( crossover );
ts_function_declare( decay_exponential );
ts_function_declare( decay_linear );
ts_function_declare( delta );
ts_function_declare( deviation_mean );
ts_function_declare( deviation_standard );
ts_function_declare( deviation_standard_exponential );
ts_function_declare( deviation_vector );
ts_function_declare( division );
ts_function_declare( exonential );
ts_function_declare( exponential_natural );
ts_function_declare( floor );
ts_function_declare( lag );
ts_function_declare( logarithm );
ts_function_declare( logarithm_binary );
ts_function_declare( logarithm_decimal );
ts_function_declare( logarithm_natural );
ts_function_declare( maximum );
ts_function_declare( minimum );
ts_function_declare( multiplication );
ts_function_declare( none );
ts_function_declare( polynomial );
ts_function_declare( power );
ts_function_declare( ratio );
ts_function_declare( reciporical );
ts_function_declare( regression_linear_simple_least_squares );
ts_function_declare( root_cube );
ts_function_declare( root_n );
ts_function_declare( root_square );
ts_function_declare( round );
ts_function_declare( secant );
ts_function_declare( secant_hyperbolic );
ts_function_declare( secant_hyperbolic_inverse );
ts_function_declare( secant_inverse );
ts_function_declare( sigmoid );
ts_function_declare( sign );
ts_function_declare( sine );
ts_function_declare( sine_hyperbolic );
ts_function_declare( sine_hyperbolic_inverse );
ts_function_declare( sine_inverse );
ts_function_declare( slope );
ts_function_declare( subtraction );
ts_function_declare( summation );
ts_function_declare( tangent );
ts_function_declare( tangent_hyperbolic );
ts_function_declare( tangent_hyperbolic_inverse );
ts_function_declare( tangent_inverse );
ts_function_declare( trix );
ts_function_declare( truncate );
ts_function_declare( variance );
ts_function_declare( variance_exponential );


#endif


// // Average Directional Movement
// //
// // 

// ts_function_define( directional_movement_average, cast_index( c, 0, uint_t ) )
// {
//   uint_t k = c->k;
// 	uint_t xi = 1;
// 	uint_t yi = 0;

//   fp_t pdm;
//   fp_t mdm;
//   fp_t pdi;
//   fp_t mdi;

// 	fp_t sum = 0;

// 	for( ; xi <= k; ++xi )
// 	{
// 		pdm = x[1][xi] - x[1][xi - 1];
//     mdm = x[2][xi] - x[2][xi - 1];

//     if( pdm > mdm )
//     {
//       mdm = 0;
//     }

//     if( mdm > pdm )
//     {
//       pdm = 0;
//     }

//     pdi = ( pdm * 100 ) /

// 	}

// 	y[0][yi - 1] = sum / k;

// 	for( ; xi < n; ++xi, ++yi )
// 	{
// 		y[0][yi] = y[0][yi - 1] + ( x[0][xi] - x[0][xi - k] ) / k;
// 	}
// }


// // Average True Range

// ts_function_define( true_range_average, c->k - 1 )
// {
// 	uint_t k = c->k;
// 	uint_t xi = 0;
// 	uint_t yi = 0;

//   fp_t t[k] = 0;
// 	fp_t ti = 0;
//   fp_t sum = 0;


// 	for( ; xi < k; ++xi )
// 	{
// 		t[ti] = fmax( ts_h( x, xi ) - ts_c( x, xi - 1 ),
//               fmax( ts_c( x, xi - 1 ) - ts_l( x, xi ), ts_h( x, xi ) - ts_l( x, xi ) ) );

// 		sum += t[ti++];
// 	}


// 	y[0][yi - 1] = sum / k;

// 	for( ; xi < n; ++xi, ++yi )
// 	{
// 		y[0][yi] =
// 	}


// }
